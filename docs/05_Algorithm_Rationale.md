# 現行アルゴリズム採用理由書

更新日: 2026-02-15

## 1. はじめに

本書は、現在採用されている**「カルマンフィルタ + EMA + デッドゾーン」**という3段階のアルゴリズム構成が、なぜ他の選択肢（単純平均など）よりも優れていると判断され、採用に至ったかの理由を説明するものです。

---

## 2. 求められる性能要件

本アプリケーション（高精度傾斜角センサー）には、相反する2つの要件がありました。

1. **高安定性（静止時）**: 置いた時に数値がピタリと止まること。0.01度の桁がチラチラ変動（フリッカー）しないこと。
2. **高応答性（動作時）**: ユーザーが傾けた時、遅れなく数値が追従すること。ヌルヌルと動くこと。

---

## 3. 各処理の採用理由

### ① カルマンフィルタ (1D Kalman Filter)

**【役割】: 真値の推定とノイズ分離**

- **なぜ採用？**:
  - 単純なローパスフィルタ（平均化）では、ノイズを消そうと強くかけると、実際の動きに対して「遅延（ラグ）」が大きくなります。
  - カルマンフィルタは「予測」と「観測」のバランスを動的に取るため、**「定常的なノイズは強力に抑えつつ、急な変動（意図的な動き）には比較的素早く反応する」** という特性があります。
  - これにより、静止時の安定性と動作時の追従性を両立させる基盤となります。

### ② 指数移動平均 (EMA: Exponential Moving Average)

**【役割】: 質感の演出（重み付け）**

- **なぜ採用？**:
  - カルマンフィルタの出力は、数学的には正しいですが、人間が見るとまだ「機械的で微少な振動」が残っていることがあります。
  - EMAを薄く掛けることで、アナログ針のような**「質量のある物体が動くような滑らかさ」**を演出できます。
  - これにより、ユーザーに「安っぽいセンサー」ではなく「精密測定器」のような操作感を与えています。

### ③ デッドゾーン (Deadzone / Hysteresis)

**【役割】: 数値の「ロック」**

- **なぜ採用？**:
  - 計算上の値が `0.001` 度でも変動すれば、デジタル表示は書き換わってしまいます。
  - ユーザー心理として、静止させているつもりなのに数値が変わると「壊れているのか？」「水平が出ない」とストレスを感じます。
  - 変化量が一定以下の場合に値を**強制的に更新しない（前の値を維持する）**ことで、**「ピタリと止まった」**という安心感を提供します。これは物理的な気泡管水準器の「摩擦で止まる感じ」を模倣しています。

---

## 4. 他の手法との比較（不採用理由）

| 手法 | 特徴 | 不採用の理由 |
| :--- | :--- | :--- |
| **単純移動平均 (SMA)** | 過去N点の平均 | ノイズを消すレベルまでNを増やすと、動き出しの反応が鈍くなり、操作感が「モッサリ」するため。 |
| **メディアンフィルタ** | 中央値 | スパイクノイズ（突発的な異常値）には強いが、連続的な振動ノイズに対しては数値が階段状に変化してしまい、滑らかさに欠けるため。 |
| **生データ (Raw)** | 加工なし | 値が暴れすぎて、0.01度の桁が判読不能になるため。 |

---

## 5. 結論

現在の構成は、以下のベストバランスを達成するために設計されています。

> **「カルマン」でノイズの本質を取り除き、**
> **「EMA」で上質な滑らかさを加え、**
> **「デッドゾーン」で最後の1桁を安定させる。**

この3段構えにより、業務用測定器に匹敵する使用感を実現しています。
