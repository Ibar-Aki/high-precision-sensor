# 精度向上施策の別案リスト（完全静止前提）

更新日: 2026-02-15

## 1. はじめに

本書では、計測対象が **「完全に静止している」** という条件下で、傾斜角センサーの精度（確度・安定性）を向上させるための代替施策をリストアップした。現在採用している「カルマンフィルタ＋EMA＋デッドゾーン」以外の選択肢を検討する際の資料とする。

> [!IMPORTANT]
> **施策Cを採用決定済み**: 「静止判定型平均（Latch & Average）」は、既存アルゴリズムとのハイブリッド構成として採用が決定した。詳細は `design/DS-04_Proposal_Hybrid_Static_Average.md` を参照のこと。

---

## 2. 統計的アプローチ（ノイズ除去）

### 施策A: 時間平均（単純移動平均 / SMA）

- **概要**: 過去 $N$ 点のデータの単純平均を取る。
- **メカニズム**: 対象が静止している場合、真値は定数であり、ノイズは平均0の正規分布に従うと仮定できる。サンプル数 $N$ を増やすほど、分散は $1/N$ に比例して減少する。
- **メリット**: 実装が極めて容易である。静的成分の抽出には理論的に最適に近い。
- **デメリット**: $N$ を大きくすると、いざ動かした時の応答が非常に遅くなる。
- **判定**: 単独採用は不採用。応答性が犠牲になるため。

### 施策B: メディアンフィルタ（中央値フィルタ）

- **概要**: 過去 $N$ 点のデータを昇順に並べ、中央値を採用する。
- **メカニズム**: スパイク状の突発的なノイズ（外れ値）を完全に無視できる。平均値フィルタでは外れ値に引きずられるが、中央値ならその影響を受けない。
- **メリット**: 突発的なセンサー異常値に強い。
- **デメリット**: ソート処理が必要なため、計算コストが平均値よりわずかに高い（現代のCPUでは無視できるレベル）。
- **判定**: 不採用。連続的な振動ノイズに対して階段状の変化が出るため。

### 施策C: 静止判定型平均（Latch & Average）⭐ 採用

- **概要**: 「動きがない」と判定された期間の全データを蓄積し、その平均値を出し続ける。動きを検知したらリセットする。
- **メリット**: 静止時間が長ければ長いほど精度が上がり続ける（究極の安定性）。
- **デメリット**: 「動き出した」判定を見誤ると、いつまでも古い値を表示し続けるリスクがある。
- **判定**: **採用（ハイブリッド構成として既存アルゴリズムと統合）**。建設現場での机水平調整というユースケースに最適である。

---

## 3. センサーフュージョン・ハードウェア活用

### 施策D: 加速度センサー特化モード（ジャイロ無視）

- **概要**: 通常 `deviceorientation` は加速度とジャイロを内部で融合しているが、静止時は「重力加速度ベクトル」のみを見れば傾斜は求まる。ジャイロ（ドリフトの原因になりうる）を無視し、`devicemotion` の `accelerationIncludingGravity` のみを使って計算する。
- **メリット**: ジャイロ特有のドリフト（時間経過でのズレ）を排除できる可能性がある。
- **デメリット**: 振動に弱くなる（ジャイロは振動に強い）。
- **判定**: 将来検討。現段階では Web API の制約が大きい。

### 施策E: ゼロ速度更新 (ZUPT: Zero Velocity Update)

- **概要**: 加速度の変化分散が閾値以下の場合、「速度はゼロである（止まっている）」と断定し、フィルタのカルマンゲインを極端に下げて、現在の推定値を強制的に固定する。
- **メリット**: デッドゾーン判定の高度なバージョンである。数値がピタリと止まる。
- **判定**: 施策Cに概念が類似。施策Cのほうが実装が簡潔なため、そちらを採用した。

---

## 4. 補正・キャリブレーションの高度化

### 施策F: 多点キャリブレーション（非線形補正）

- **概要**: 現在の1点（0度）補正に加え、+90度、-90度などの点でもキャリブレーションを行い、センサーのクセ（非線形性）を補正するマップを作成する。
- **メリット**: ノイズではなく「ズレ（偏り）」を根本的に減らせる。特に角度が大きくなった時の精度が向上する。
- **判定**: 将来検討。机水平調整では角度0度付近のみ使用するため、優先度は低い。

### 施策G: 温度補正（理論案）

- **概要**: センサー（MEMS）は温度変化で特性が変わる。温度センサーの値を用いて補正係数を調整する。
- **備考**: Web API経由では正確なデバイス温度が取得できないことが多く、実装は困難な場合が多いが、精度要因としては大きい。
- **判定**: 不採用。Web APIの制約により実現困難である。

---

## 5. 比較まとめ表

| 施策 | 静止精度 | ノイズ除去力 | 実装難易度 | 判定 |
| :--- | :--- | :--- | :--- | :--- |
| **A: 単純平均** | 高 | 高 (N大なら) | 低 | 不採用（応答性問題） |
| **B: メディアン** | 中 | 強 (スパイク) | 低 | 不採用（階段状変化） |
| **C: 静止平均積算** | **特大** | **特大** | 中 | **⭐ 採用** |
| **D: 加速度のみ** | 高 | 中 | 中 | 将来検討 |
| **E: ZUPT** | 高 | 高 | 中 | 施策Cに統合 |
| **F: 多点補正** | - | - | 高 | 将来検討 |
| **G: 温度補正** | - | - | 高 | 不採用（API制約） |
