# 要件定義書: 高精度傾斜角センサー PWA
作成日時: 2026-02-14 01:54:13 +09:00
作成者: Codex＋GPT-5
更新日: 2026-02-24

## 1. 文書目的
本書は、iPhone を対象とした高精度傾斜角センサー PWA の要件を機能・品質・制約の観点で定義し、開発・検証・運用の基準とすることを目的とする。

## 2. 適用範囲
- 対象アプリケーション: `High-precision-sensor`
- 対象プラットフォーム: iOS Safari（PWA インストール運用を含む）
- 対象機能: 傾斜角計測、表示、音声フィードバック、設定永続化、オフライン対応

## 3. 用語定義
- ピッチ: 端末の前後方向の傾斜角
- ロール: 端末の左右方向の傾斜角
- キャリブレーション: 現在値を基準値としてオフセット補正する操作

## 4. ステークホルダー
- 利用者: 設備据付・保守担当者
- 開発者: フロントエンド実装担当者
- 保守担当者: 不具合修正および性能調整担当者

## 5. 機能要件
1. センサー権限
- 起動時に DeviceOrientation 権限を要求し、拒否時は利用不能理由を明示すること。

2. 計測処理
- ピッチ・ロールの2軸値を取得し、カルマンフィルタ・EMA・デッドゾーンを適用して表示すること。
- 計測中はリアルタイムで UI を更新すること。

3. 表示機能
- 数値表示（ピッチ、ロール、合成角）を行うこと。
- 方向表示（前傾・後傾・左傾・右傾・水平）を行うこと。
- 水準器バブルおよび角度弧を更新すること。

4. 音声機能
- 前後左右を識別可能な音色で出力すること。
- 常時モードと閾値モードを切替可能とすること。
- マスター音量と閾値を設定可能とすること。

5. 操作機能
- キャリブレーション、統計リセット、値ロックを提供すること。

6. 設定永続化
- フィルタ係数、音声設定、表示設定をローカル保存し、再起動時に復元すること。

7. PWA 対応
- Manifest および Service Worker を提供し、オフライン利用可能な静的資産をキャッシュすること。

## 6. 非機能要件
1. 可用性
- 初期画面表示から計測開始までの操作は 2 ステップ以内とする。

2. 応答性
- センサー更新に対し、体感遅延が過度に増加しないこと（平滑化設定に依存する）。

3. 信頼性
- センサー値が無効値（`null`/`undefined`/`NaN`）の場合は処理をスキップすること。

4. 保守性
- 設定値および演算パラメータは UI から調整可能とすること。

5. セキュリティ/プライバシー
- センサーデータを外部送信しないこと。

## 7. 制約事項
- DeviceOrientation API の精度は端末個体差・ブラウザ実装差の影響を受ける。
- HTTPS 以外では Service Worker 等の機能が制限される。
- 絶対精度は専用計測機器と同等にはならない。

## 8. 受入基準
- 権限拒否時にエラーメッセージが表示されること。
- 計測開始後にピッチ・ロール・合成角が継続更新されること。
- キャリブレーション操作で表示値が基準化されること。
- 設定変更が再読み込み後も保持されること。
- `manifest.json` と `sw.js` が配信され、主要静的資産が HTTP 200 で取得可能であること。

## 9. 将来拡張要件
- 加速度・ジャイロ統合による姿勢推定高度化
- 測定ログの時系列保存・CSV 出力
- 校正プロファイル管理
